<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PlanDrop Settings</title>
  <script>
    // Prevent flash of wrong theme
    (function() {
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>PlanDrop Settings</h1>
    </header>

    <main>
      <!-- Servers Section -->
      <section class="section">
        <div class="section-header">
          <h2>Servers</h2>
          <button id="add-server-btn" class="btn btn-primary">+ Add Server</button>
        </div>

        <div id="servers-list" class="list">
          <div class="empty-state">No servers configured. Add a server to get started.</div>
        </div>
      </section>

      <!-- Server Edit Modal -->
      <div id="server-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="server-modal-title">Add Server</h3>
            <button class="close-btn" data-close="server-modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="server-name">Display Name</label>
              <input type="text" id="server-name" placeholder="e.g., Lab GPU Server">
            </div>

            <div class="form-group">
              <label>SSH Connection Type</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="ssh-type" value="alias" checked>
                  <span>SSH Config Alias (recommended)</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="ssh-type" value="direct">
                  <span>Direct Connection</span>
                </label>
              </div>
            </div>

            <div id="alias-fields">
              <div class="form-group">
                <label for="ssh-alias">SSH Alias</label>
                <input type="text" id="ssh-alias" placeholder="e.g., labgpu (from ~/.ssh/config)">
                <span class="help-text">Use an alias defined in your ~/.ssh/config file</span>
              </div>
            </div>

            <div id="direct-fields" class="hidden">
              <div class="form-row">
                <div class="form-group flex-2">
                  <label for="ssh-host">Hostname / IP</label>
                  <input type="text" id="ssh-host" placeholder="192.168.1.100">
                </div>
                <div class="form-group flex-1">
                  <label for="ssh-port">Port</label>
                  <input type="number" id="ssh-port" value="22">
                </div>
              </div>
              <div class="form-group">
                <label for="ssh-username">Username</label>
                <input type="text" id="ssh-username" placeholder="user">
              </div>
              <div class="form-group">
                <label for="ssh-key">SSH Key Path (optional)</label>
                <input type="text" id="ssh-key" placeholder="~/.ssh/id_rsa">
              </div>
            </div>

            <div class="form-group">
              <button id="test-connection-btn" class="btn btn-secondary">
                Test Connection
              </button>
              <span id="test-result" class="test-result"></span>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-close="server-modal">Cancel</button>
            <button id="save-server-btn" class="btn btn-primary">Save Server</button>
          </div>
        </div>
      </div>

      <!-- Project Edit Modal -->
      <div id="project-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="project-modal-title">Add Project</h3>
            <button class="close-btn" data-close="project-modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="project-name">Project Name</label>
              <input type="text" id="project-name" placeholder="e.g., RNA-seq Pipeline">
            </div>
            <div class="form-group">
              <label for="project-path">Remote Directory Path</label>
              <input type="text" id="project-path" placeholder="/home/user/projects/rnaseq">
              <span class="help-text">Absolute path on the remote server</span>
            </div>

            <div class="form-divider">
              <span>Interactive Mode Settings</span>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="project-interactive">
                <span>Enable interactive mode</span>
              </label>
              <span class="help-text">Use plan-review-execute workflow with Claude Code</span>
            </div>

            <div class="form-row">
              <div class="form-group flex-1">
                <label for="project-profile">Permission Profile</label>
                <select id="project-profile">
                  <option value="plan_only">üìã Plan Only</option>
                  <option value="edit_files">üìù Edit Files Only</option>
                  <option value="standard">‚ö° Standard</option>
                  <option value="full_access">üîì Full Access</option>
                  <option value="custom">‚öôÔ∏è Custom</option>
                </select>
              </div>
              <div class="form-group flex-1">
                <label for="project-model">Default Model</label>
                <select id="project-model">
                  <option value="opus">Opus (Quality)</option>
                  <option value="sonnet">Sonnet (Speed)</option>
                </select>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-close="project-modal">Cancel</button>
            <button id="save-project-btn" class="btn btn-primary">Save Project</button>
          </div>
        </div>
      </div>

      <!-- Custom Profiles Section -->
      <section class="section">
        <div class="section-header">
          <h2>Custom Profiles</h2>
          <button id="add-profile-btn" class="btn btn-secondary">+ New Profile</button>
        </div>
        <p class="section-description">Create custom permission profiles based on built-in templates.</p>
        <div id="custom-profiles-list" class="list">
          <div class="empty-state">No custom profiles. Use the built-in profiles or create your own.</div>
        </div>
      </section>

      <!-- Custom Profile Modal -->
      <div id="profile-modal" class="modal hidden">
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h3 id="profile-modal-title">New Custom Profile</h3>
            <button class="close-btn" data-close="profile-modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group flex-2">
                <label for="profile-name">Profile Name</label>
                <input type="text" id="profile-name" placeholder="e.g., genomics-prod">
              </div>
              <div class="form-group flex-1">
                <label for="profile-base">Base Profile</label>
                <select id="profile-base">
                  <option value="edit_files">Edit Files Only</option>
                  <option value="standard">Standard</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>Additional Allowed Commands</label>
              <div id="profile-allow-list" class="tag-list"></div>
              <div class="form-row">
                <input type="text" id="profile-allow-input" placeholder="e.g., cellranger" class="flex-2">
                <button id="add-allow-btn" class="btn btn-small btn-secondary">+ Add</button>
              </div>
              <span class="help-text">Command prefixes to allow (e.g., samtools, bedtools)</span>
            </div>

            <div class="form-group">
              <label>Additional Blocked Commands</label>
              <div id="profile-deny-list" class="tag-list"></div>
              <div class="form-row">
                <input type="text" id="profile-deny-input" placeholder="e.g., curl" class="flex-2">
                <button id="add-deny-btn" class="btn btn-small btn-secondary">+ Add</button>
              </div>
              <span class="help-text">Command prefixes to block</span>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-close="profile-modal">Cancel</button>
            <button id="save-profile-btn" class="btn btn-primary">Save Profile</button>
          </div>
        </div>
      </div>

      <!-- General Settings -->
      <section class="section">
        <h2>General Settings</h2>

        <div class="form-group">
          <label for="theme-select">Theme</label>
          <select id="theme-select">
            <option value="auto">Auto (system)</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
          <span class="help-text">Auto follows your operating system preference.</span>
        </div>

        <div class="form-group">
          <label for="default-filename">Default Filename</label>
          <input type="text" id="default-filename" value="plan.md">
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="auto-clipboard" checked>
            <span>Auto-fill from clipboard when popup opens</span>
          </label>
        </div>

        <div class="form-group">
          <label for="default-view">Default Editor View</label>
          <select id="default-view">
            <option value="split">Split View</option>
            <option value="edit">Edit Only</option>
            <option value="preview">Preview Only</option>
          </select>
        </div>
      </section>

      <!-- Import/Export -->
      <section class="section">
        <h2>Import / Export</h2>
        <div class="button-group">
          <button id="export-btn" class="btn btn-secondary">Export Settings</button>
          <button id="import-btn" class="btn btn-secondary">Import Settings</button>
          <input type="file" id="import-file" accept=".json" class="hidden">
        </div>
      </section>
    </main>

    <footer>
      <p>PlanDrop v2.0.0</p>
    </footer>
  </div>

  <script src="options.js"></script>
</body>
</html>
